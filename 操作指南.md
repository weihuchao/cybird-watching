## Windows 系统环境安装

Hosts 文件： C:\Windows\System32\drivers\etc

15款优秀的终端工具推荐：https://www.cnblogs.com/PeterJXL/p/18418016

Fluent Terminal： 
- https://apps.microsoft.com/detail/9p2krlmfxf9t?hl=zh-cn&gl=HK
- https://github.com/felixse/FluentTerminal

GetStoreApp：https://github.com/Gaoyifei1011/GetStoreApp/releases/tag/v6.12.1220.0

Installing ZSH on Windows：https://github.com/zinox9/zsh-windows?tab=readme-ov-file

- https://cygwin.com/install.html

```bash
wget rawgit.com/transcode-open/apt-cyg/master/apt-cyg
install apt-cyg /bin
apt-cyg install zsh git gdb dos2unix openssh vim
```

修改 C:\cygwin64\etc\nsswitch.conf
```
db_home: windows
```

https://github.com/ohmyzsh/ohmyzsh

```bash
git clone https://github.com/ohmyzsh/ohmyzsh.git ./.oh-my-zsh
cp ./.oh-my-zsh/templates/zshrc.zsh-template ./.zshrc
chsh -s $(which zsh)
```

## 一些操作

```bash
find . -name "*.pyc" -print0 | xargs -0 rm -f
Get-ChildItem -Path . -Recurse -Filter *.pyc | Remove-Item -Force

git add .
git commit -m 'update'
git push
git status
```


## 环境安装

https://pyinstaller.org/en/stable/installation.html#installed-commands

```bash
pip install --upgrade pyinstaller
pyinstaller --version

python
import sysconfig; print(sysconfig.get_path("scripts"))
import site; print(site.USER_BASE + "\\Scripts")

# 向 PATH 环境变量
C:\Users\weihc\AppData\Roaming\Python\Python313\Scripts
```

### 向 PATH 环境变量中添加工具位置

https://learn.microsoft.com/zh-cn/previous-versions/office/developer/sharepoint-2010/ee537574(v=office.14)

在"开始"菜单中，右键单击"计算机"。
在上下文菜单中，单击"属性"。
在"系统"对话框中，单击"高级系统设置"。
在"系统属性"对话框的"高级"选项卡上，单击"环境变量"。
在"环境变量"对话框的"系统变量"框中，滚动到"Path"，并选择它。
单击对话框的两个"编辑"按钮中位于下方的那一个。
在"编辑系统变量"对话框中，滚动到"变量值"框中的字符串的末尾，并添加分号 (;)。
在分号后添加新路径。
在三个连续的对话框中，单击"确定"，然后关闭"系统"对话框。

### AIO_Tool 编译

```bash
pip install Pillow
pip install requests
pip install pyserial
pip install ipython

cd C:\Code\HoloCubic_AIO\AIO_Tool\
pyinstaller --icon ./image/holo_256.ico -w -F CubicAIO_Tool.py
```

#### 踩坑

```bash
pip install esptool
pip uninstall esptool

# 正确安装方式
pip install -e c:\Code\HoloCubic_AIO\AIO_Tool\esptool_v41
```


### 虚拟环境

```bash
pip install virtualenv

# https://github.com/astral-sh/uv
powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"

To add C:\Users\weihc\.local\bin to your PATH, either restart your shell or run:
```

### uv 的使用

```bash
uv self update
uv python list

cd C:\Code\HoloCubic_AIO\AIO_Tool\
uv python pin 3.13.5
uv venv
.venv\Scripts\activate
```

## 赛博观鸟

### 移除统计和文字

### 触发切换动画的实现

```cpp
BirdManager::triggerBird
    // 设置触发请求,由UI任务处理
    trigger_request_.pending = true;
    trigger_request_.type = trigger_type;
    trigger_request_.bird_id = 0; // 随机小鸟
    trigger_request_.record_stats = true;

BirdTriggerRequest trigger_request_;

BirdManager::processTriggerRequest()

bool BirdManager::playRandomBird() {
    BirdInfo bird = selector_->getRandomBird();
    return playBird(bird.id, true);
}

processTriggerRequest
playBirdWithoutRecording
playRandomBird



void processBirdTriggerRequest() {
    g_birdManager->processTriggerRequest();
}

void TaskManager::uiTaskFunction(void* parameter){
	BirdWatching::processBirdTriggerRequest();
}

bool triggerBird(uint16_t bird_id) {
    if (bird_id == 0) {
        // 随机触发
        return g_birdManager->triggerBird(TRIGGER_MANUAL);
    } else {
        // 触发指定小鸟
        return g_birdManager->triggerBirdById(bird_id, TRIGGER_MANUAL);
    }
}

TaskManager::sendToUITask
TaskManager::sendToSystemTask

TaskMessage msg;
msg.type = MSG_TRIGGER_BIRD;
taskMgr->sendToUITask(msg);
```

#### 事件循环

```cpp
// C:\Code\cybird-watching\src\system\tasks\task_manager.cpp
void TaskManager::uiTaskFunction(void* parameter)
{
    while (true) {
        // 处理消息队列(非阻塞)
        while (xQueueReceive(manager->ui_queue_, &msg, 0) == pdTRUE) {
            // 处理UI相关消息
            switch (msg.type) {
                case MSG_TRIGGER_BIRD:
                    // 触发小鸟动画
                    if (manager->takeLVGLMutex(100)) {
                        BirdWatching::triggerBird();
                        manager->giveLVGLMutex();
                    }
            }
        }
        if (manager->takeLVGLMutex(10)) {
            BirdWatching::processBirdTriggerRequest();
        }
    }
}

```

#### main loop

```cpp
// C:\Code\cybird-watching\src\main.cpp
void loop()
{    
    // 随机间隔 1..6 秒
    static unsigned long statsIntervalMs = 0;
    if (statsIntervalMs == 0) {
        statsIntervalMs = 1000 + (esp_random() % 5001); // 1000..6000
    }

    if (currentTime - lastStatsTime >= statsIntervalMs) { // 每60秒打印一次
        if (taskManager) {
            // 触发一次小鸟动画以测试任务间通信
            LOG_INFO("TASK_LOOP", "Triggering bird animation");
            TaskMessage msg;
            msg.type = MSG_TRIGGER_BIRD;
            taskManager->sendToUITask(msg);
        }
        lastStatsTime = currentTime;
        // 重新计算下一次间隔
        statsIntervalMs = 1000 + (esp_random() % 5001);
    }
    // 让出CPU给FreeRTOS调度器
    delay(1000);
}

```

### 权重和持续时间



