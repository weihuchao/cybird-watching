# 赛博观鸟应用测试指南

## 概述

赛博观鸟应用已成功集成到ESP32项目中，包含以下核心功能：
- 随机小鸟选择和动画播放
- 权重基础的鸟类出现概率
- 统计记录和保存
- 手势触发支持（基础版本）
- 串口命令控制

## 当前功能状态

### ✅ 已完成功能

1. **核心系统架构**
   - BirdAnimation: 图片序列动画播放器
   - BirdSelector: 权重基础随机选择器
   - BirdStatistics: 观鸟数据统计
   - BirdManager: 系统协调管理器

2. **动画系统**
   - 支持RGB565格式图片序列
   - 240x240像素分辨率
   - 8-12fps可配置帧率
   - 自动帧切换和清理

3. **小鸟选择系统**
   - 内置4种默认小鸟：麻雀、知更鸟、雀鹰、燕子
   - 权重分配：麻雀(50%), 知更鸟(30%), 燕子(20%), 雀鹰(10%)
   - 支持从配置文件加载（待实现）

4. **统计系统**
   - 记录每种鸟的遇见次数
   - 追踪首次和最后遇见时间
   - JSON格式数据序列化
   - 定期自动保存

5. **资源系统**
   - 完整的目录结构
   - 占位符动画帧（38帧）
   - 配置文件模板
   - 资源生成工具

6. **用户交互**
   - 串口命令接口
   - 手势检测框架
   - 自动定时触发
   - 手动触发支持

### 🚧 待完善功能

1. **文件I/O集成**
   - SD卡配置文件加载
   - 统计数据持久化
   - 小鸟资源文件读取

2. **手势检测完善**
   - 完整的MPU手势集成
   - 触发阈值优化
   - 手势识别准确性提升

## 测试方法

### 1. 串口命令测试

连接设备后，通过串口监视器发送以下命令：

```bash
# 手动触发小鸟动画
bird trigger

# 查看当前统计信息
bird stats

# 查看系统状态
status
```

### 2. 自动触发测试

系统默认配置：
- 自动触发间隔：30秒
- 统计保存间隔：5分钟
- 手势模拟测试：10秒间隔

观察设备是否：
- 定期播放小鸟动画
- 串口输出触发日志
- 动画播放流畅

### 3. 动画效果测试

预期行为：
- 显示彩色占位符帧
- 每只小鸟有不同颜色主题
- 动画播放时间：1-2秒
- 播放完成后自动清理

### 4. 内存使用监控

当前资源占用：
- RAM: 19.1% (62,524 / 327,680 bytes)
- Flash: 44.9% (588,637 / 1,310,720 bytes)

## 配置调整

### BirdConfig参数

```cpp
struct BirdConfig {
    bool enable_gesture_trigger = true;    // 手势触发开关
    int auto_trigger_interval = 30;        // 自动触发间隔(秒)
    int stats_save_interval = 300;         // 统计保存间隔(秒)
};
```

### 修改方法

在 `src/applications/modules/bird_watching/core/bird_manager.cpp` 的 `initialize()` 函数中调整配置参数。

## 资源文件位置

```
resources/
├── birds/
│   ├── sparrow/frames/pic-01.bin ~ pic-08.bin
│   ├── robin/frames/pic-01.bin ~ pic-10.bin
│   ├── sparrowhawk/frames/pic-01.bin ~ pic-12.bin
│   └── swallow/frames/pic-01.bin ~ pic-08.bin
└── tools/
    └── create_placeholder_frames.py
```

## 下一步开发建议

1. **实际小鸟资源**
   - 制作真实的小鸟动画序列
   - 转换为RGB565格式
   - 优化帧数和文件大小

2. **完整手势集成**
   - 完成MPU手势检测集成
   - 优化触发阈值
   - 添加手势训练模式

3. **用户界面**
   - 添加观鸟统计显示界面
   - 进度指示器
   - 小鸟信息展示

4. **数据持久化**
   - 实现SD卡文件读写
   - 配置文件热重载
   - 数据备份和恢复

## 故障排除

### 常见问题

1. **动画不播放**
   - 检查资源文件是否存在
   - 确认SD卡初始化成功
   - 查看串口错误日志

2. **手势不响应**
   - 确认MPU6050连接正常
   - 检查I2C通信
   - 调整手势检测阈值

3. **内存不足**
   - 减少同时加载的资源
   - 优化图像分辨率
   - 调整缓冲区大小

### 调试命令

```bash
# 查看详细日志
log level debug

# 检查系统状态
system info

# 重置统计
bird reset
```

---

**项目状态**: 核心功能完成，进入测试和优化阶段
**最后更新**: 2025-11-27